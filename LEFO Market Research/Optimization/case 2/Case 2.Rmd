---
title: "Training Optimization"
subtitle: "Contoh Kasus"
author: "Ikanx Fadhli @nutrifood"
date: "21 Maret 2021"
output:
  html_document:
    toc: true
    toc_depth: 5
    toc_float: 
        collapsed: false
    number_sections: false
    theme: darkly
    highlight: pygments
    fig_caption: yes
    code_folding: hide
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
options(scipen = 99)
```

# Kasus _Optimization_ II

## Masalah

Di sebuah perusahaan, departemen _filling_ dan _packing_ memiliki tiga jenis mesin yang selalu beroperasi setiap harinya. Setiap mesin memiliki kapasitas, biaya proses per unit produk, dan biaya _setup_ masing-masing.

Berikut adalah datanya:

```{r}
data = data.frame(
  mesin =  c(1:3),
  biaya_setup = c(300,100,200),
  biaya_proses_unit = c(2,10,5),
  kapasitas = c(600,800,1200)
)
knitr::kable(data,align = "c",caption = "Data Mesin Filling dan Packing")
```
Mengingat di setiap mesin harus ada pekerja yang ditugaskan untuk menjalankannya, manajemen mengambil keputusan bahwa jika suatu mesin digunakan, maka mesin tersebut paling sedikit harus memproses `400` unit produk. 

Di suatu hari, terdapat beban kerja sebanyak `2000` unit produk yang harus diproses _filling_ dan _packing_-nya. 

> ___Berapa konfigurasi produk per mesin yang paling optimal?___

## Model Matematika

Dari kasus di atas, kita akan membuat model matematikanya.

### Variabel Penentuan

Misalkan saya notasikan `3` variabel berikut ini:

- $x_1$ sebagai seberapa banyak (dalam unit) produk yang dijalankan di mesin I,
- $x_2$ sebagai seberapa banyak (dalam unit) produk yang dijalankan di mesin II, dan 
- $x_3$ sebagai seberapa banyak (dalam unit) produk yang dijalankan di mesin III.

Di mana:

$$x_1,x_2,x_3	\in \mathbb{Z}$$

### _Constraints_

Berikut adalah _constraints_ yang ada pada kasus di atas:

- $400 \leq x_1 \leq 600$
- $400 \leq x_2 \leq 800$
- $400 \leq x_3 \leq 1200$
- $x_1 + x_2 + x_3 = 2000$

### _Objective Function_

Tujuan utama permodelan matematika ini adalah __meminimalkan__ _cost_ yang terjadi di semua mesin, yakni:

$$min((300+2x_1) + (100+10x_2) + (200+5x_3))$$

## _Solver R_

### Penulisan Model Matematika di __R__

Untuk menyelesaikan masalah ini, saya akan menggunakan _solver_ di __R__. Berikut adalah model yang saya buat:

```{r,message=FALSE,warning=FALSE}
# dimulai dengan hati yang bersih
rm(list=ls())

# memanggil libraries
library(dplyr)
library(ompr)
library(ompr.roi)
library(ROI.plugin.glpk)

#  set vector fixed cost
fixed_cost = c(300000,100000,200000)

# set vector cost per unit
cost_per_unit = c(2000,10000,5000)

# membuat model
model = 
  MIPModel() %>%
  # add variables
  # non negative integers
  add_variable(x[i],i = 1:3,
               type = "integer",
               lb = 400) %>%
  # set obj function
  set_objective((fixed_cost[1]+cost_per_unit[1]*x[1]) + (fixed_cost[2]+cost_per_unit[2]*x[2]) + (fixed_cost[3]+cost_per_unit[3]*x[3]),
                "min") %>%
  # add constraints
  add_constraint(x[1] <= 600) %>% 
  add_constraint(x[2] <= 800) %>% 
  add_constraint(x[3] <= 1200) %>% 
  add_constraint(sum_expr(x[i],i = 1:3) == 2000)
model
```

### _Solving_

Kemudian saya _solve_ dengan __R__:

```{r,message=FALSE,warning=FALSE}
result = solve_model(model, with_ROI(solver = "glpk", verbose = TRUE))
```

### _Final Result_

Saya dapatkan konfigurasi terbaik seperti ini:

```{r,message=FALSE,warning=FALSE}
result %>% get_solution(x[i])
```

Dengan _profit_ maksimum sebesar Rp`r round(result$objective_value/1000000,3)` juta.

---